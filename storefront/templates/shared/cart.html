<div class="cart-sidenav sidenav" id="cart-slide-out">
  <div class="minicart-loader hide">
    <div class="loader-box"><img class="loader-icon" width="40" height="40" src="/images/loader_blue.svg"> <span class="load-msg">Updating Cart</span></div>
  </div>
  <div class="cart-container">
    <div class="cart-header">
      <div class="header-body">
        <h3 class="header-title">Shopping Cart</h3>
        <% if @cart["items"].any? %>
        <p class="header-subtotal">Subtotal: <span data-amount="cart-subtotal"><%= Money.from_cents(@cart["priceSummary"]["total"]).format %></span></p>
        <% end %>
      </div>
      <button class="btn-cart-close sidenav-close" type="button">
        <svg viewBox="0 0 44 44" fill="#e3002b" height="20px" width="20px">
          <path d="M29.071 11.393a2.5 2.5 0 013.536 3.536L14.929 32.607a2.5 2.5 0 01-3.536-3.536z"></path>
          <path d="M32.607 29.071a2.5 2.5 0 01-3.536 3.536L11.393 14.929a2.5 2.5 0 013.536-3.536z"></path>
        </svg>
        Close
      </button>
    </div>
    <div class="cart-location-container">
      <div class="cart-location-info">
        <img src="https://images.dutchie.com/885caedbdb7f68347d80b8c6175d3194" alt="Happy Valley - Gloucester" class="cart-location-img" />
        <dl class="cart-shopping-location">
          <dt>Shopping at:</dt>
          <dd>Happy Valley - <%= @store_subdomain.humanize %></dd>
        </dl>
      </div>
      <span class="cart-order-type">Pickup</span>
    </div>
    <% if @cart["items"].any? %>
    <div class="cart-checkout-mobile">
      <a class="btn btn-primary btn-checkout" href="<%= session[:redirect_url] %>">Proceed To Checkout - <%= Money.from_cents(@cart["priceSummary"]["total"]).format %></a>
    </div>
    <% end %>
    <div class="cart-items">
      <% if @cart["items"].any? %>
      <ul>
        <% @cart["items"].each do |item| %>
        <li
          class="cart-item"
          data-cost='<%= Money.from_amount(item["product"]["variants"].select{|m| m["option"] == item["option"] }.map{|p|  actual_price_num(@menu_type, p).to_f  }.sum * item["quantity"]).format  %>'
        >
          <img class="cart-item-img" src="<%= item["product"]["image"] %>" width="50" />
          <div class="cart-item-info">
            <% menu = Menu.find_by(dutchie_id: item["product"]['id']) %>
            <% if item["isDiscounted"] %>
              <div class="cart-discount-bubble">$<%= Money.from_cents(item["discounts"]["total"]) %> discount applied!</div>
            <% end %>
            <a href="<%= menu&.slug_url %>"><strong class="cart-item-name"><%= item["product"]["name"] %></strong></a>
            <div class="cart-item-actions">
              <% if item["product"]["variants"].any? %>
              <div class="input-field input-no-border">
                <span class="cart-item-weight"><%= item["option"] %></span>
                <!-- <select name="item_weight" data-weight='<%= item["option"] %>'>
                  <% item["product"]["variants"].each do |variant| %>
                    <option data-cost="<%= actual_price(@menu_type, variant) %>" value="<%= variant['option'] %>" <%= "selected" if variant["option"] == item["option"] %>><%= variant["option"] %></option>
                  <% end %>
                </select> -->
              </div>
              <div class="item-separator"></div>
              <% end %>
              <button type="button" class="btn-cart-remove" data-id="<%= item['id'] %>">
                <svg width="14" height="15" viewBox="0 0 14 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path
                    d="M13.3857 1.66513H9.99076V0.921478C9.99076 0.404157 9.50577 0 8.90762 0H5.07621C4.47806 0 3.99307 0.404157 3.99307 0.921478V1.66513H0.598152C0.25866 1.66513 0 1.92379 0 2.26328C0 2.60277 0.25866 2.86143 0.598152 2.86143H1.3418L2.08545 12.1732C2.10162 13.2725 2.99076 14.1455 4.09007 14.1455H9.90993C11.0092 14.1455 11.8822 13.2725 11.9145 12.1732L12.6582 2.8776H13.4018C13.7413 2.8776 14 2.61894 14 2.27945C14 1.93995 13.7252 1.66513 13.3857 1.66513ZM5.20554 1.21247H8.79446V1.66513H5.20554V1.21247ZM10.7182 12.0924V12.1247C10.7182 12.5612 10.3626 12.9169 9.9261 12.9169H4.09007C3.65358 12.9169 3.29792 12.5612 3.29792 12.1247L2.55427 2.86143H11.4619L10.7182 12.0924Z"
                    fill="#969EA5"
                  ></path>
                  <path
                    d="M5.41567 10.9284H5.43183C5.77133 10.9122 6.01382 10.6212 6.01382 10.3141L5.78749 5.43184C5.77133 5.10851 5.51266 4.84985 5.18934 4.84985H5.17317C4.83368 4.86602 4.59119 5.15701 4.59119 5.46417L4.81751 10.3464C4.81751 10.702 5.10851 10.9284 5.41567 10.9284Z"
                    fill="#969EA5"
                  ></path>
                  <path
                    d="M8.55203 10.9284H8.56819C8.89152 10.9284 9.15018 10.6697 9.16635 10.3464L9.39267 5.46417C9.40884 5.12468 9.15018 4.84985 8.81069 4.84985H8.79452C8.47119 4.84985 8.21253 5.10851 8.19637 5.43184L7.98621 10.3141C7.98621 10.6374 8.21253 10.9122 8.55203 10.9284Z"
                    fill="#969EA5"
                  ></path>
                </svg>
                Remove
              </button>
            </div>
          </div>
          <div class="cart-item-secondary">
              <select class="cart-item-quantity browser-default" name="item_quantity" data-quantity='<%= item["quantity"] %>'  data-id="<%= item['id'] %>">
                <% 1.upto(25) do |q| %>
                  <option value="<%= q %>"<%= " selected" if q == item["quantity"].to_i %>><%= q %></option>
                <% end %>
              </select>
            <span data-amount="item-subtotal" class="cart-item-subtotal"
                                              >
              <%= Money.from_amount(item["product"]["variants"].select{|m| m["option"] == item["option"] }.map{|p|  actual_price_num(@menu_type, p).to_f  }.sum * item["quantity"]).format
              %></span
            >
          </div>
        </li>
        <% end %>
      </ul>
      <% end %>
      <% if @cart["items"].length === 0 %>
      <div class="cart-empty-container">
        <svg width="126" height="115" viewBox="0 0 126 115" fill="none" xmlns="http://www.w3.org/2000/svg">
            <ellipse opacity="0.59" cx="61.3673" cy="112.535" rx="35.232" ry="2.41028" fill="#BDCCCE"></ellipse>
            <path
                d="M108.809 34.7854C108.806 33.6502 107.888 32.7316 106.756 32.7316H20.9775L18.5736 17.8165C18.4129 16.8192 17.5544 16.0862 16.5476 16.0862H5.82421C4.69076 16.0862 3.77197 17.0081 3.77197 18.1453C3.77197 19.2826 4.69076 20.2045 5.82421 20.2045H14.8005L17.1988 35.085L19.111 49.9019C19.1112 49.9037 19.1116 49.9056 19.1119 49.9074C19.1123 49.9107 19.1127 49.914 19.1131 49.9173L24.0071 85.7098C24.5107 89.3943 27.571 92.2023 31.2035 92.3821C29.527 94.3958 28.5154 96.9971 28.5154 99.8338C28.5154 106.208 33.6247 111.395 39.9045 111.395C46.1844 111.395 51.2935 106.209 51.2935 99.8338C51.2935 97.0014 50.2848 94.4038 48.613 92.3914H73.8441C72.1723 94.4038 71.1637 97.0016 71.1637 99.8338C71.1637 106.208 76.2727 111.395 82.5528 111.395C88.8326 111.395 93.9417 106.209 93.9417 99.8338C93.9417 96.9343 92.8848 94.2809 91.1414 92.2493C95.792 91.4827 99.5593 87.6891 100.224 82.8305L104.48 51.6962H106.794C107.34 51.6962 107.862 51.4786 108.247 51.0912C108.632 50.7039 108.848 50.1788 108.847 49.6317L108.809 34.7854ZM47.189 99.834C47.189 103.938 43.9212 107.277 39.9045 107.277C35.8879 107.277 32.6199 103.938 32.6199 99.834C32.6199 95.7301 35.8879 92.3916 39.9045 92.3916C43.9212 92.3914 47.189 95.7301 47.189 99.834ZM82.5526 107.276C78.5359 107.276 75.2679 103.938 75.2679 99.8338C75.2679 95.7299 78.5359 92.3914 82.5526 92.3914C86.5692 92.3914 89.837 95.7301 89.837 99.8338C89.837 103.937 86.5692 107.276 82.5526 107.276ZM96.1569 82.271C95.6892 85.6927 92.7869 88.2731 89.4062 88.2731H31.5741C29.8219 88.2731 28.3168 86.9305 28.0734 85.1501L23.4995 51.6964H100.337L96.1569 82.271Z"
                fill="#C8CFD1"
            ></path>
            <path
                d="M108.809 34.7854C108.806 33.6502 107.888 32.7316 106.756 32.7316H20.9775L18.5736 17.8165C18.4129 16.8192 17.5544 16.0862 16.5476 16.0862H5.82421C4.69076 16.0862 3.77197 17.0081 3.77197 18.1453C3.77197 19.2826 4.69076 20.2045 5.82421 20.2045H14.8005L17.1988 35.085L19.111 49.9019C19.1112 49.9037 19.1116 49.9056 19.1119 49.9074C19.1123 49.9107 19.1127 49.914 19.1131 49.9173L24.0071 85.7098C24.5107 89.3943 27.571 92.2023 31.2035 92.3821C29.527 94.3958 28.5154 96.9971 28.5154 99.8338C28.5154 106.208 33.6247 111.395 39.9045 111.395C46.1844 111.395 51.2935 106.209 51.2935 99.8338C51.2935 97.0014 50.2848 94.4038 48.613 92.3914H73.8441C72.1723 94.4038 71.1637 97.0016 71.1637 99.8338C71.1637 106.208 76.2727 111.395 82.5528 111.395C88.8326 111.395 93.9417 106.209 93.9417 99.8338C93.9417 96.9343 92.8848 94.2809 91.1414 92.2493C95.792 91.4827 99.5593 87.6891 100.224 82.8305L104.48 51.6962H106.794C107.34 51.6962 107.862 51.4786 108.247 51.0912C108.632 50.7039 108.848 50.1788 108.847 49.6317L108.809 34.7854ZM104.709 36.8499L104.737 47.5781H22.95L21.5655 36.8499H104.709ZM47.189 99.834C47.189 103.938 43.9212 107.277 39.9045 107.277C35.8879 107.277 32.6199 103.938 32.6199 99.834C32.6199 95.7301 35.8879 92.3916 39.9045 92.3916C43.9212 92.3914 47.189 95.7301 47.189 99.834ZM82.5526 107.276C78.5359 107.276 75.2679 103.938 75.2679 99.8338C75.2679 95.7299 78.5359 92.3914 82.5526 92.3914C86.5692 92.3914 89.837 95.7301 89.837 99.8338C89.837 103.937 86.5692 107.276 82.5526 107.276Z"
                fill="white"
            ></path>
            <path
                d="M108.809 34.7854C108.806 33.6502 107.888 32.7316 106.756 32.7316H20.9775L18.5736 17.8165C18.4129 16.8192 17.5544 16.0862 16.5476 16.0862H5.82421C4.69076 16.0862 3.77197 17.0081 3.77197 18.1453C3.77197 19.2826 4.69076 20.2045 5.82421 20.2045H14.8005L17.1988 35.085L19.111 49.9019C19.1112 49.9037 19.1116 49.9056 19.1119 49.9074C19.1123 49.9107 19.1127 49.914 19.1131 49.9173L24.0071 85.7098C24.5107 89.3943 27.571 92.2023 31.2035 92.3821C29.527 94.3958 28.5154 96.9971 28.5154 99.8338C28.5154 106.208 33.6247 111.395 39.9045 111.395C46.1844 111.395 51.2935 106.209 51.2935 99.8338C51.2935 97.0014 50.2848 94.4038 48.613 92.3914H73.8441C72.1723 94.4038 71.1637 97.0016 71.1637 99.8338C71.1637 106.208 76.2727 111.395 82.5528 111.395C88.8326 111.395 93.9417 106.209 93.9417 99.8338C93.9417 96.9343 92.8848 94.2809 91.1414 92.2493C95.792 91.4827 99.5593 87.6891 100.224 82.8305L104.48 51.6962H106.794C107.34 51.6962 107.862 51.4786 108.247 51.0912C108.632 50.7039 108.848 50.1788 108.847 49.6317L108.809 34.7854ZM104.709 36.8499L104.737 47.5781H22.95L21.5655 36.8499H104.709ZM96.1569 82.271C95.6892 85.6927 92.7869 88.2731 89.4062 88.2731H31.5741C29.8219 88.2731 28.3168 86.9305 28.0734 85.1501L23.4995 51.6964H100.337L96.1569 82.271Z"
                fill="white"
            ></path>
            <path d="M77.3824 105.561C83.7882 103.295 86.9049 99.6798 85.3896 91.6455L92.7101 98.2055L86.9049 108.294L77.3824 105.561Z" fill="#E3E7E8"></path>
            <path d="M20.5308 36.2091L105.808 35.8074V42.2348L21.3315 39.0211L20.5308 36.2091Z" fill="#A1ACAF"></path>
            <path d="M34.1431 105.561C40.5489 103.295 43.6656 99.6798 42.1504 91.6455L49.4709 98.2055L43.6656 108.294L34.1431 105.561Z" fill="#E3E7E8"></path>
            <path d="M100.203 61.5172L23.333 88.8337H96.1992L100.203 61.5172Z" fill="#C8CFD1" fill-opacity="0.5"></path>
            <path
                d="M108.809 34.7854C108.806 33.6502 107.888 32.7316 106.756 32.7316H20.9775L18.5736 17.8165C18.4129 16.8192 17.5544 16.0862 16.5476 16.0862H5.82421C4.69076 16.0862 3.77197 17.0081 3.77197 18.1453C3.77197 19.2826 4.69076 20.2045 5.82421 20.2045H14.8005L17.1988 35.085L19.111 49.9019C19.1112 49.9037 19.1116 49.9056 19.1119 49.9074C19.1123 49.9107 19.1127 49.914 19.1131 49.9173L24.0071 85.7098C24.5107 89.3943 27.571 92.2023 31.2035 92.3821C29.527 94.3958 28.5154 96.9971 28.5154 99.8338C28.5154 106.208 33.6247 111.395 39.9045 111.395C46.1844 111.395 51.2935 106.209 51.2935 99.8338C51.2935 97.0014 50.2848 94.4038 48.613 92.3914H73.8441C72.1723 94.4038 71.1637 97.0016 71.1637 99.8338C71.1637 106.208 76.2727 111.395 82.5528 111.395C88.8326 111.395 93.9417 106.209 93.9417 99.8338C93.9417 96.9343 92.8848 94.2809 91.1414 92.2493C95.792 91.4827 99.5593 87.6891 100.224 82.8305L104.48 51.6962H106.794C107.34 51.6962 107.862 51.4786 108.247 51.0912C108.632 50.7039 108.848 50.1788 108.847 49.6317L108.809 34.7854ZM104.709 36.8499L104.737 47.5781H22.95L21.5655 36.8499H104.709ZM47.189 99.834C47.189 103.938 43.9212 107.277 39.9045 107.277C35.8879 107.277 32.6199 103.938 32.6199 99.834C32.6199 95.7301 35.8879 92.3916 39.9045 92.3916C43.9212 92.3914 47.189 95.7301 47.189 99.834ZM82.5526 107.276C78.5359 107.276 75.2679 103.938 75.2679 99.8338C75.2679 95.7299 78.5359 92.3914 82.5526 92.3914C86.5692 92.3914 89.837 95.7301 89.837 99.8338C89.837 103.937 86.5692 107.276 82.5526 107.276ZM96.1569 82.271C95.6892 85.6927 92.7869 88.2731 89.4062 88.2731H31.5741C29.8219 88.2731 28.3168 86.9305 28.0734 85.1501L23.4995 51.6964H100.337L96.1569 82.271Z"
                fill="#788387"
            ></path>
            <ellipse cx="3.71512" cy="52.2775" rx="3.20291" ry="3.21371" fill="#788387" fill-opacity="0.5"></ellipse>
            <ellipse cx="71.7772" cy="16.9269" rx="2.40219" ry="2.41028" fill="#788387" fill-opacity="0.3"></ellipse>
            <ellipse cx="111.413" cy="8.49101" rx="2.80255" ry="2.81199" fill="#788387" fill-opacity="0.3"></ellipse>
            <g opacity="0.3">
                <path
                    d="M29.3386 0.791421C29.3386 0.384678 29.6971 0.0549469 30.1393 0.0549469C30.5816 0.0549469 30.9401 0.384678 30.9401 0.791421V8.15616C30.9401 8.56291 30.5816 8.89264 30.1393 8.89264C29.6971 8.89264 29.3386 8.56291 29.3386 8.15616V0.791421Z"
                    fill="#5E6D79"
                ></path>
                <path
                    d="M34.143 3.73732C34.5852 3.73732 34.9437 4.06705 34.9437 4.47379C34.9437 4.88054 34.5852 5.21027 34.143 5.21027H26.1357C25.6935 5.21027 25.335 4.88054 25.335 4.47379C25.335 4.06705 25.6935 3.73732 26.1357 3.73732H34.143Z"
                    fill="#5E6D79"
                ></path>
            </g>
            <g opacity="0.5">
                <path
                    d="M118.886 64.396C118.886 63.9153 119.304 63.5256 119.82 63.5256C120.336 63.5256 120.755 63.9153 120.755 64.396V73.0998C120.755 73.5805 120.336 73.9702 119.82 73.9702C119.304 73.9702 118.886 73.5805 118.886 73.0998V64.396Z"
                    fill="#5E6D79"
                ></path>
                <path
                    d="M124.491 67.8775C125.007 67.8775 125.426 68.2672 125.426 68.7479C125.426 69.2286 125.007 69.6183 124.491 69.6183H115.15C114.634 69.6183 114.215 69.2286 114.215 68.7479C114.215 68.2672 114.634 67.8775 115.15 67.8775H124.491Z"
                    fill="#5E6D79"
                ></path>
            </g>
        </svg>
        <div class="cart-empty-title">Your Cart is Empty</div>
        <button class="cart-empty-btn sidenav-close"><div>Add some products!</div></button>
      </div>
      <% end %>
      
      <div class="cart-location-container" style="padding:12px"></div>
      <% if @cart["items"].present? %>
          <% related = Menu.find_by(id: @cart["items"].last.dig("product","id")).related_items(2) %>
          <% if related.present? %>
            <%= render partial: 'before_you_go', locals: {template: 'web', cart_product:  @cart["items"].last.dig("product","id"), related: related} %>
          <% end %>
      <% end %>
    </div>
    <% if @cart["items"].any? %>
    <div class="cart-footer">
      <a class="btn btn-primary btn-checkout" href="<%= session[:redirect_url] %>">Proceed To Checkout</a>

      <p class="cart-subtotal-container">
        <strong class="cart-subtotal">Subtotal: <span data-amount="cart-subtotal"><%= Money.from_cents(@cart["priceSummary"]["total"]).format %></span></strong>
      </p>
    </div>
    <% end %>
  </div>
</div>
<input type="hidden" id="cartTotal" value="{{store.cart_total}}"/>
<input type="hidden" id="cartSize" value="{{store.cart_size }}" />
<script>
  document.addEventListener("DOMContentLoaded", function(){
    document.getElementsByClassName("cart-count-d")[0].innerHTML = {{store.cart_size }};
    document.getElementsByClassName("cart-count-m")[0].innerHTML = {{store.cart_size }};
  });
</script>
<style type="text/css">
  .before-you-go {
    padding-top: 12px;
    padding-left: 28px;
  }
  .before-you-go h3 {
    font-weight: bold;
    font-size: 16px;
  }

</style>
